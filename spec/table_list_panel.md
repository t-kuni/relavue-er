# テーブル一覧パネル仕様

## 概要

ER図に含まれるエンティティ（テーブル）の一覧を左サイドバーに表示する機能。
ファジー検索による絞り込みと、テーブル名クリックによる選択・パン操作を提供する。

関連仕様：
- フロントエンドの状態管理については[frontend_state_management.md](./frontend_state_management.md)を参照
- エンティティ選択については[entity_selection_and_ddl_panel.md](./entity_selection_and_ddl_panel.md)を参照
- 型定義については`scheme/main.tsp`を参照
- 国際化については[internationalization.md](./internationalization.md)を参照

## パネルの配置

- 左サイドバーとして表示
- ツールバーボタンで表示/非表示を切り替える
- レイヤーパネルと排他表示とする。テーブル一覧パネルを開くとレイヤーパネルは閉じ、レイヤーパネルを開くとテーブル一覧パネルは閉じる

### サイドバー幅の変更

- サイドバーの右縁をドラッグすることで表示幅を変更できる
- 最小幅・最大幅を設ける（最小 150px、最大 600px 程度）
- 幅はローカル状態で管理する（ViewModelには持たない）
- レイヤーパネルとテーブル一覧パネルは同じ左サイドバーを共有するため、設定した幅は両方に適用される

## フィルター機能

### 入力欄

- パネル上部にテキスト入力欄を配置する
- 入力に応じてリアルタイムにテーブル一覧を絞り込む

### ファジーマッチングの仕様

テーブル名と検索語のどちらも正規化したうえで、部分列（subsequence）マッチングを行う。

**正規化ルール**：
- スペース・アンダースコアなどの区切り文字を除去する
- 大文字小文字を区別しない（すべて小文字に統一する）

**マッチング条件**：
- 正規化後の検索語が正規化後のテーブル名の部分列（subsequence）であればマッチとする
- 部分列とは、テーブル名の文字を元の順序を保ちながら検索語のすべての文字が見つかることを意味する

**マッチング例**（テーブル名 `apple_orange_peach` の場合）：

| 入力 | 正規化後の入力 | マッチ |
|---|---|---|
| `apple` | `apple` | ✓ |
| `appora` | `appora` | ✓ |
| `appea` | `appea` | ✓ |
| `app pea` | `apppea` | ✓ |
| `app_pea` | `apppea` | ✓ |

### フィルター状態の管理

- フィルターテキストはコンポーネントのローカル状態で管理する（ViewModelには持たない）
- パネルを閉じて再度開いたときはフィルターをリセットする
- エクスポート・インポートの対象外

## テーブル一覧の表示

- テーブル名をリスト形式で表示する
- 表示順序はアルファベット順（昇順）とする
- フィルター適用後の一覧を表示する（フィルター未入力時は全テーブルを表示）
- テーブルが存在しない場合（ER図が空の場合）は空状態メッセージを表示する
- テーブル名がサイドバーの幅を超える場合は、はみ出した部分を非表示にし末尾を省略記号（…）で表示する（折り返しなし）

## キーボードショートカット

- **Ctrl+F**（Mac: Cmd+F）：テーブル一覧パネルを開き、絞り込み入力欄にフォーカスする
  - パネルが閉じている場合：パネルを開き、入力欄にフォーカスする。ブラウザのデフォルト動作（ブラウザ検索）を抑止する
  - パネルが開いていて入力欄にフォーカスが当たっていない場合：入力欄にフォーカスする。ブラウザのデフォルト動作を抑止する
  - パネルが開いていて入力欄にフォーカスが当たっている場合：何もせず、ブラウザのデフォルト動作（ブラウザ検索）を許可する（フォールバック）

## テーブル名クリック時の動作

クリックされたテーブルに対して以下の2つの操作を同時に行う：

- 該当エンティティを選択状態にする（`actionSelectItem`を使用）
- ER図キャンバスを該当エンティティが画面中央に来るようにパンする（アニメーションあり）

パンはReact Flowの`setCenter()`を使用して実現する。現在のズームレベルは変更しない。
エンティティが既に選択中の状態でクリックされた場合も、同じ動作（再選択・再パン）を行う。

## 状態管理

### GlobalUIState への追加

`GlobalUIState.showTableListPanel: boolean` でパネルの表示/非表示を管理する。

詳細はデータ構造を `scheme/main.tsp` に定義すること。

### Action

- `actionToggleTableListPanel(vm)`: テーブル一覧パネルの表示/非表示を切り替える
  - パネルを開く場合、`showLayerPanel` を `false` にする（排他表示）
  - パネルを閉じる場合、`showLayerPanel` は変更しない

## 国際化

以下のテキストを多言語対応とする（翻訳キーは `table_list_panel` 名前空間）：

- パネルタイトル
- フィルター入力欄のプレースホルダー
- テーブルが存在しない場合の空状態メッセージ

## ツールバーボタン

テーブル一覧パネルの表示/非表示を切り替えるボタンをツールバーに追加する。
ボタンの配置順序については[internationalization.md](./internationalization.md)を参照。
